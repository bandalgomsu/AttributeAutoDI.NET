# AttributeAutoDI

> ğŸŒŸ Attribute ê¸°ë°˜ ì˜ì¡´ì„± ìë™ ë“±ë¡ ë¼ì´ë¸ŒëŸ¬ë¦¬

---
## Nuget
> 

---
## ğŸ’¡ êµ¬í˜„ ë™ê¸° 

ASP.NET Coreì˜ ê¸°ë³¸ DI ì»¨í…Œì´ë„ˆëŠ” ë§¤ìš° ê°„ë‹¨í•˜ê³  ê°•ë ¥í•˜ì§€ë§Œ,  
ì„œë¹„ìŠ¤ ë“±ë¡ì„ ìœ„í•´ ë§¤ë²ˆ `builder.Services.AddXXX<>()`ë¥¼ ë°˜ë³µí•˜ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì€ ë¶ˆí¸ì„ ì´ˆë˜í–ˆìŠµë‹ˆë‹¤:

- **ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ë“±ë¡ ì½”ë“œê°€ ê¸¸ì–´ì§€ê³  ê´€ë¦¬ê°€ ì–´ë ¤ì›€**
- **ë‹¤ì¤‘ êµ¬í˜„ì²´(ì˜ˆ: ì¸í„°í˜ì´ìŠ¤ Aë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ê°€ ì—¬ëŸ¬ ê°œ) ìƒí™©ì—ì„œ ëª…í™•í•œ ì£¼ì… ì§€ì •ì´ ë²ˆê±°ë¡œì›€**
- **í´ë˜ìŠ¤ ì„ ì–¸ê³¼ ë“±ë¡ ì½”ë“œê°€ ì„œë¡œ ë¶„ë¦¬ë˜ì–´ ìˆì–´, ì˜ë„ê°€ ì½”ë“œì— ë“œëŸ¬ë‚˜ì§€ ì•ŠìŒ**

> ì´ëŸ¬í•œ ë¬¸ì œì ì— ëŒ€í•œ í•´ê²°ì±…ìœ¼ë¡œ Attributeë¥¼ ë– ì˜¬ë ¸ìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ `AttributeAutoDI`ëŠ” ë‹¤ìŒ ì² í•™ì„ ë°”íƒ•ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤:

- âœ… **ì„œë¹„ìŠ¤ëŠ” ìê¸° ìì‹ ì´ ì–´ë–»ê²Œ ì‚¬ìš©ë ì§€ ì„ ì–¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤**
- âœ… **êµ¬í˜„ì²´ê°€ ì—¬ëŸ¬ ê°œì—¬ë„ Primary/Namingìœ¼ë¡œ ëª…í™•í•˜ê²Œ êµ¬ë¶„ë  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤**
- âœ… **ë¶ˆí•„ìš”í•œ ë“±ë¡ ì½”ë“œ ì—†ì´ë„ ëª…í™•í•œ DI êµ¬ì„±ì„ ì œê³µí•´ì•¼ í•œë‹¤**

> ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìƒì‚°ì„±ê³¼ ëª…ì‹œì„±ì„ ëª¨ë‘ ì¶”êµ¬í•©ë‹ˆë‹¤. 
> ì•ˆì „í•˜ë©´ì„œë„ ëœ ê·€ì°®ì€ ê°œë°œí™˜ê²½ì„ êµ¬ì¶•í•˜ê³ .
> "ë‚´ê°€ ë“±ë¡í–ˆë‚˜?" ë³´ë‹¤ "ë“±ë¡ì´ ì˜ ë˜ì–´ ìˆê² ì§€"ë¼ê³  ë¯¿ì„ ìˆ˜ ìˆê²Œ.

> ìµœì¢…ì ìœ¼ë¡œëŠ” Program.cs , Startup.cs ì˜ ì±…ì„ì„ ì¤„ì—¬ì„œ ìµœëŒ€í•œ ê°„ì†Œí™” í•˜ëŠ”ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.
---

## ğŸ§¾ ìš”êµ¬ì‚¬í•­

- .NET 6.0 ì´ìƒ
- Microsoft.Extensions.DependencyInjection ì‚¬ìš© ê¸°ë°˜ í”„ë ˆì„ì›Œí¬ (ASP.NET Core, Console ë“±)

---

## ğŸ”¥ ì£¼ìš” ê¸°ëŠ¥

- âœ… `[Singleton]`, `[Scoped]`, `[Transient]` í´ë˜ìŠ¤ ì˜ì¡´ì„± ìë™ ë“±ë¡
- â­ `[Primary]` ì§€ì • ì‹œ ë‹¤ì¤‘ êµ¬í˜„ì²´ ì¤‘ ê¸°ë³¸ê°’ ìë™ ì§€ì •
- ğŸ·ï¸ `[Named]` ì§€ì • í›„ íŒŒë¼ë¯¸í„°ì— `[Named("...")]`ë¡œ ëª…ì‹œì  ì£¼ì…
- ğŸ› ï¸ `[Options()]` ì§€ì • ì‹œ IOptions ìë™ ë°”ì¸ë”© ! 
- ğŸ‘¾ `[PreConfiguration]` , `[PostConfiguration]` í´ë˜ìŠ¤ í•˜ìœ„ì˜ , `[Execute]` ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì„¤ì • ë©”ì„œë“œ ì‹¤í–‰ 
---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. Extension ë“±ë¡
```jsx
builder.Services.AddAttributeDependencyInjection(builder.Configuration);
```
or
```jsx
builder.Services.AddAttributeDependencyInjection(builder.Configuration,typeof(Program).Assembly);
```

AddAttributeDependencyInjection() Extensionì€ ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤
```jsx
public static class AttributeInjectionExtension
{
    public static void AddAttributeDependencyInjection(
    this IServiceCollection services,
    IConfiguration configuration,
    Assembly? assembly = null
)
{
    assembly ??= Assembly.GetEntryAssembly();

    services.UsePreConfiguration(assembly!);

    services.UseOptionsBindingInjection(configuration, assembly!);
    services.UseAttributeInjection(assembly!);
    services.UsePrimaryInjection();
    services.UseNameParameterInjection(assembly!);
    services.Replace(ServiceDescriptor.Transient<IControllerActivator, NamedControllerActivator>());

    services.UsePostConfiguration(assembly!);
}
```

### ì‹¤í–‰ íë¦„ 
1. PreConfiguration í•˜ìœ„ Execute ë©”ì„œë“œ ì‹¤í–‰ 
2. Options ë“±ë¡ 
3. [Singleton] , [Transient] , [Scoped] í´ë˜ìŠ¤ ì˜ì¡´ì„± ë“±ë¡ 
4. [Primary] ì˜ì¡´ì„± ë“±ë¡ 
5. [Named]ê°€ ë¶™ì€ íŒŒë¼ë¯¸í„° í´ë˜ìŠ¤ ë° Controller Activator ë“±ë¡ 
6. PostConfiguration í•˜ìœ„ Execute ë©”ì„œë“œ ì‹¤í–‰ 


### ì£¼ì˜ 
```jsx
builder.Service.AddSingleton...
builder.Service.AddAttributeDependencyInjection 
```
- ìœ„ì˜ ì½”ë“œëŠ” ì˜ë„í•œëŒ€ë¡œ ì‘ë™í•©ë‹ˆë‹¤ í•˜ì§€ë§Œ
```jsx
builder.Service.AddAttributeDependencyInjection
builder.Service.AddSingleton...
```
ì´ ì½”ë“œëŠ” ì˜ë„í•œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ AttributeAutoDIê°€ ì œê³µí•˜ëŠ” ë“±ë¡ë°©ë²•ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ìˆœì„œë¥¼ ìœ ì˜í•´ì£¼ì„¸ìš”.

### 2. í´ë˜ìŠ¤ ì˜ì¡´ì„± ìë™ ì£¼ì… - [Singleton], [Transient], [Scoped]
```jsx
[Singleton]
public class MyService : IMyService
{
    public string Get() => "hello";
}
```
ì´ê²ƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤
```jsx
builder.Services.AddSingleton<IMyService, MyService>();
```

### 3. ë‹¤ì¤‘ êµ¬í˜„ì²´ ì¤‘ ê¸°ë³¸ê°’ ì§€ì • - [Primary]
```jsx

[Singleton]
public class MyService : IMyService
{
    public string Get() => "hello";
}

[Primary]
[Singleton]
public class MyPrimaryService : IMyService
{
    public string Get() => "I am primary";
}
```
ì´ê²ƒì€ IMyServiceê°€ ì£¼ì…ë  ë•Œ MyPrimaryServiceê°€ ì£¼ì…ë˜ëŠ”ê²ƒì„ ë³´ì¥í•©ë‹ˆë‹¤.
```jsx
[Singleton]
public class TestFacade(IMyservice myservice)
{
    ...
}
// myservice == MyPrimaryService
```

### 4. ëª…ì‹œì  ì£¼ì… ê¸°ëŠ¥ - [Named]
[Named]ë¥¼ í†µí•´ì„œ ì£¼ì… êµ¬í˜„ì²´ì¤‘ ì´ë¦„ê³¼ ë§¤í•‘ë˜ëŠ” êµ¬í˜„ì²´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
```jsx
[Singleton]
public class MyService : IMyService
{
    public string Get() => "hello";
}
```
--> ê¸°ë³¸ì ìœ¼ë¡œ LowerCamelCaseë¡œ ì´ë¦„ì´ ë“±ë¡ë©ë‹ˆë‹¤. (MyService -> myService)
```jsx
[Singleton("myNamedService")]
public class MyService : IMyService
{
    public string Get() => "hello";
}
```
--> name í”„ë¡œí¼í‹°ë¥¼ í†µí•´ì„œ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
```jsx
[Singleton]
public class TestFacade([Named("myNamedService")]IMyservice myservice)
{
...
}
// myservice == MyService
```
--> íŒŒë¼ë¯¸í„°ì— [Named]ë¥¼ í†µí•´ì„œ ì´ë¦„ê³¼ ë§¤í•‘ë˜ëŠ” êµ¬í˜„ì²´ë¥¼ ì£¼ì…ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (NamedParameter ì‹¤í–‰ ì‹œì ì— ë“±ë¡ëœ í´ë˜ìŠ¤ë§Œ ì‘ë™í•©ë‹ˆë‹¤)

### 5. ì˜µì…˜ ë°”ì¸ë”© ê¸°ëŠ¥ - [Options]
```jsx
[Options("Sample:Sample")]
public class SampleOption
{
    public string Sample { get; set; } = "";
}
```
ì´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤.
```jsx
builder.Services.Configure<SampleOption>(configuration.GetSection("Sample:Sample"));
```
ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ ì£¼ì…ë°›ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```jsx
public class SampleController(
    IOptions<SampleOption> sampleOption) ...
```

### 6. Configuration ê¸°ëŠ¥ - [PreConfiguration] , [PostConfiguration] , [Execute]
AddAttributeDependencyInjection ì „ í›„ë¡œ [Execute]ê°€ ë¶™ì€ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

PreConfiguration -> AddAttributeDependencyInjection -> PostConfiguration ìˆœìœ¼ë¡œ ì‹¤í–‰

```jsx
[PreConfiguration] //or [PostConfiguration]
public static class Configuration{
    [Execute]
    public static void TestConfig1(IServiceCollection service){
        ...
    }

    [Execute]
    public static void TestConfig2(this IServiceCollection service){
    ...
    }
    
    [Execute]
    public static void TestConfig3(IServiceCollection service, IConfiguration configuration){
        ...
    }

    [Execute]
    public static void TestConfig4(this IServiceCollection service, IConfiguration configuration){
    ...
    }
}
```

ìœ„ì— 4ê°œì˜ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë§Œ ì‘ë™í•©ë‹ˆë‹¤ (ë¦¬í„´ íƒ€ì…ì€ ìƒê´€ X)

---

## ğŸ§ª ì˜ˆì œ
ì˜ˆì œëŠ” AttributeAutoDi.Sample í”„ë¡œì íŠ¸ë¥¼ í†µí•´ì„œ í™•ì¸í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ™Œ ê¸°ì—¬í•˜ê¸°
ì·¨ì•½ì ì´ë‚˜ ê°œì„ ì ì„ ë°œê²¬í•˜ë©´ ì´ìŠˆ ë“±ë¡ ë˜ëŠ” PR ë¶€íƒë“œë¦½ë‹ˆë‹¤.

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤
MIT License
Copyright (c) 2025


